var Index=function(){const csrf_token=$('meta[name="csrf-token"]').attr("content");var table;const transaksiID=$("#transaksiId").val();var handleTransaksiItem=function(){table=$("#tableItemTransaksi").DataTable({responsive:!0,autoWidth:!0,pageLength:10,searching:!0,paging:!0,lengthMenu:[[10,25,50],[10,25,50]],language:{info:"Menampilkan _START_ - _END_ dari _TOTAL_ data",infoEmpty:"Menampilkan 0 - 0 dari 0 data",infoFiltered:"",zeroRecords:"Data tidak di temukan",loadingRecords:"Loading...",processing:"Processing..."},columnsDefs:[{searchable:!1,target:[0,1]},{orderable:!1,target:0}],processing:!0,serverSide:!0,ajax:{url:url+"/admin/view-transaksi-details",type:"POST",data:{_token:csrf_token,transaksi_id:transaksiID}},columns:[{data:"rnum",orderable:!1},{data:"jenis_sampah",orderable:!1},{data:"qty",orderable:!1},{data:"subtotal",orderable:!1},{data:"action",orderable:!1}],drawCallback:function(response){const sumTotal=response.json.sum;handleTotal(sumTotal)}})},handleTotal=function(sumTotal){$("#total").val(sumTotal)},handleAddTransaksiDetail=function(){$("#formTransakasiItemDetail").submit((function(e){e.preventDefault();const form=$(this);let formData=new FormData(form[0]);$.ajax({type:"POST",url:url+"/admin/transaksi-detail",data:formData,processData:!1,contentType:!1,success:function(response){toastr.success("Data Berhasil Disimpan","Success"),setTimeout((function(){table.ajax.reload(null,!1),$("#formTransakasiItemDetail").trigger("reset")}),2e3)},error:function(response){$.each(response.responseJSON,(function(key,value){toastr.error(value)}))}})}))},handleUpdateTotal=function(){$("#formTotalTransaksi").submit((function(e){e.preventDefault();const form=$(this);let formData=new FormData(form[0]);confirm("apakah transaksi sudah sesuai?")&&$.ajax({type:"POST",url:url+"/admin/transaksi/proses/"+transaksiID,data:formData,processData:!1,contentType:!1,success:function(response){toastr.success("Data Berhasil Disimpan","Success"),setTimeout((function(){document.location.href=url+"/admin/transaksi/success/"+response.data}),4e3)},error:function(response){$.each(response.responseJSON,(function(key,value){toastr.error(value)}))}})}))},handleDeleteItem=function(){$(document).on("click",".btnDelete",(function(){const idButton=$(this).data("id");confirm("apakah anda yakin?")&&$.ajax({type:"DELETE",url:url+"/admin/transaksi-detail/"+idButton,data:{_token:csrf_token},success:function(response){toastr.success("Data Berhasil Disimpan","Success"),table.ajax.reload()},error:function(response){$.each(response.responseJSON,(function(key,value){toastr.error(value)}))}})}))},handleEditItem=function(){$(document).on("click",".btnEdit",(function(){const idButton=$(this).data("id");$.ajax({type:"POST",url:url+"/admin/transaksi-item-detail/"+idButton,data:{_token:csrf_token},success:function(response){const dataResponse=response.data;$("#editItemTransaksiDetail").modal("toggle"),$("#namaItem").html(dataResponse.jenis_sampah_transaksi.nama_sampah),$("#editIndex").val(dataResponse.id),$("#qtyEdit").val(dataResponse.qty),$("#subTotalEdit").val(dataResponse.subtotal)},error:function(response){$.each(response.responseJSON,(function(key,value){toastr.error(value)}))}})}))},handleUpdateItem=function(){$("#formEditItemTransaksi").submit((function(e){e.preventDefault();const form=$(this);let formData=new FormData(form[0]);const itemId=$("#editIndex").val();confirm("apakah data sudah sesuai?")&&$.ajax({type:"POST",url:url+"/admin/transaksi-item-detail/"+itemId,data:formData,processData:!1,contentType:!1,success:function(response){toastr.success("Data Berhasil Diperbarui","Success"),setTimeout((function(){location.reload()}),3e3)},error:function(response){$.each(response.responseJSON,(function(key,value){toastr.error(value)}))}})}))};return{init:function(){handleAddTransaksiDetail(),handleTransaksiItem(),handleUpdateTotal(),handleDeleteItem(),handleEditItem(),handleUpdateItem()}}}();$(document).ready((function(){Index.init()}));